<link rel="stylesheet" type="text/css" href="/b/css/user.css">
<script>
$(function () {
	$('[data-toggle="popover"]').popover();
});
$(document).on("click", ".hover-anchor", function() {
	$selector = $(this).data("scroll");
	$highlight = $(this).data("highlight");
	event.preventDefault();
	target = $($selector);
	$('html, body').animate(
		{scrollTop: target.offset().top},
		1000,
		function() {
			// Callback after animation
			// Must change focus!
			var $target = $(target);
			$target.focus();
			if ($target.is(":focus")) { // Checking if the target was focused
				return false;
			} else {
				$target.attr('tabindex','-1'); // Adding tabindex for elements not focusable
				$target.focus(); // Set focus again
				if ($highlight) {
					$target.addClass($highlight);
					setTimeout(function() {
						$target.removeClass($highlight);
					}, 500);
				}
			};
		}
	);
});
</script>
<div class="d-flex flex-column">
	<div class="d-flex justify-content-around py-3 header {{jlc.status()}} position-relative" title="{{jlc.status() == '' ? '' : 'Account is disabled on JLC'}}">
		<button class="btn btn-danger bmd-btn-fab edit-profile" ng-if="user_can('edit', 'user')" ng-click="showProfile()">
			<i class="material-icons">edit</i>
		</button>
		<div class="d-flex">
			<img src="{{user.photo_url ? user.photo_url : user.gender=='female' ? '/b/images/female.png' : '/b/images/male.png'}}" width="100" height="100" class="rounded-circle mr-5">
			<div class="d-flex flex-column justify-content-center">
				<div class="d-flex justify-content-between">
					<label class="name {{user.frozen ? 'text-warning' : ''}}" title="{{user.frozen ? 'Account is currently frozen' : ''}}">{{user.name}}</label>
					<a class="btn btn-raised btn-sm ml-2 {{user.frozen ? 'btn-warning' : 'btn-primary'}}" ng-show="!!user.jig_id" href="https://jigsawacademy.net/accounts/1/users?utf8=%E2%9C%93&focus=user_name&user%5Bname%5D={{user.jig_id}}" target="_blank" title="{{user.frozen ? 'Account is currently frozen' : ''}}">{{user.jig_id}}</a>
					<button class="btn btn-raised btn-primary btn-sm ml-2" ng-show="!!user.lms_soc_link" ng-click="textCopy(user.lms_soc_link)" title="Click to copy access setup link"><i class="fas fa-paste"></i></button>
				</div>
				<div class="d-flex contact">
					<div class="dropdown">
						<div class="d-flex" id="phoneOptions" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="material-icons text-light">phone</i>
							<label class="text-light">{{user.phone ? user.phone : 'NA'}}</label>
							<div class="dropdown-menu {{user.phone ? '' : 'hidden'}}" aria-labelledby="phoneOptions">
								<button class="dropdown-item" ng-click="initiateCall()">Call</button>
								<button class="dropdown-item" ng-click="textCopy(user.phone)">Copy</button>
							</div>
						</div>
					</div>
					<div class="d-flex ml-5">
						<i class="material-icons text-light">email</i>
						<label class="text-light" ng-if="!user.email">NA</label>
						<a class="text-light pt-0" href="mailto:{{user.email}}" ng-if="!!user.email">{{user.email ? user.email : 'NA'}}</a>
						<button ng-if="user.email_2" class="btn btn-light py-0 ml-2" role="button" data-toggle="popover" data-placement="right" data-html="true" data-content="<a href='mailto:{{user.email_2}}'>{{user.email_2}}</a>">+1</button>
					</div>
				</div>
				<div class="d-flex contact" ng-if="location!=''" style="font-size:90%">
					<i class="material-icons text-light">location_on</i>
					<label class="text-light text-capitalize">{{location}}</label>
				</div>
			</div>
		</div>
		<div class="d-flex justify-content-center">
			<button class="btn btn-raised btn-primary my-auto position-relative" title="Notifications from {{user.name}}" ng-show="notifications.length>0" data-toggle="modal" data-target="#notifications">
				<i class="material-icons">{{notifications.length ? 'notifications_active' : 'notifications_none'}}</i>
				<span class="b-badge bg-danger" ng-show="notifications.length > 0">{{notifications.length}}</span>
			</button>
			<button class="btn btn-raised btn-primary my-auto ml-4" title="{{user.name}}'s Survey Information" data-toggle="modal" data-target="#accessSetup" ng-if="!!user.survey_date">
				<i class="material-icons">info</i>
			</button>
			<button class="btn btn-raised btn-primary my-auto ml-4" title="{{user.name}}'s Platforms" data-toggle="modal" data-target="#platforms" ng-if="!!user.platforms">
				<i class="material-icons">school</i>
			</button>
			<button class="btn btn-raised btn-primary my-auto ml-4" title="{{appAccessTitle}}" ng-click="checkAppAccess()" ng-if="user.jig_id">
				<i class="material-icons">{{appAccess}}</i>
			</button>
			<button class="btn btn-raised btn-primary my-auto ml-4" title="{{user.name}}'s Lab Information" data-toggle="modal" data-target="#labInformation" ng-if="user.labs.length>0">
				<i class="fas fa-microscope" style="font-size:27px"></i>
			</button>
			<button class="btn btn-raised my-auto ml-4 {{user.frozen ? 'btn-warning' : 'btn-primary'}}" title="{{user.name}}'s Freeze Information" data-toggle="modal" data-target="#freezeInformation" ng-if="user.freeze.length>0">
				<i class="far fa-snowflake" style="font-size:27px"></i>
			</button>
			<!-- <button class="btn btn-raised btn-primary my-auto ml-4" ng-click="startChat()">
				<i class="material-icons">chat</i>
			</button> -->
		</div>
	</div>
</div>
<div class="d-flex justify-content-center bg-light">
	<div class="py-2 mr-5 {{user.lms_soc=='fb' ? 'text-primary' : 'text-muted'}}" ng-show="user.soc_fb" ng-attr-title="{{user.lms_soc=='fb' ? 'JLC login' : ''}}">
		<i class="fab fa-facebook"></i>
		<label class="ml-2">{{user.soc_fb}}</label>
	</div>
	<div class="py-2 mr-5 {{user.lms_soc=='gp' ? 'text-primary' : 'text-muted'}}" ng-show="user.soc_gp" ng-attr-title="{{user.lms_soc=='gp' ? 'JLC login' : ''}}">
		<i class="fab fa-google-plus-square"></i>
		<label class="ml-2">{{user.soc_gp}}</label>
	</div>
	<div class="py-2 mr-5 {{user.lms_soc=='li' ? 'text-primary' : 'text-muted'}}" ng-show="user.soc_li" ng-attr-title="{{user.lms_soc=='li' ? 'JLC login' : ''}}">
		<i class="fab fa-linkedin"></i>
		<label class="ml-2">{{user.soc_li}}</label>
	</div>
</div>
<div class="row mx-0">
	<div class="col-10 pt-2 d-flex flex-column">
		<ul class="nav nav-tabs bg-secondary nav-fill">
			<li class="nav-item" ng-repeat="(s, subs) in user.subs">
				<a class="nav-link py-2 text-white {{$index==0 ? 'active' : ''}}" data-toggle="tab" data-target="#{{s}}" href="">{{s}}</a>
			</li>
		</ul>
		<div class="tab-content px-1 py-2">
			<div class="tab-pane fade {{$index==0 ? 'show active' : ''}}" id="{{s}}" role="tabpanel" aria-labelledby="{{s}}-tab" ng-repeat="(s, subsByStatus) in user.subs">
				<div class="card mb-3 highlightable" ng-repeat="subs in subsByStatus" id="subs-{{subs.subs_id}}">
					<div class="card-header {{bundleTypeClasses[subs.bundle_type]}} d-flex justify-content-between">
						<div>
							<span>{{subs.bundle}}</span>
							<span class="ml-3" ng-if="subs.bootcamp_batch_meta">({{subs.bootcamp_batch_meta.name}})</span>
						</div>
						<div ng-if="!!subs.start_date">{{subs.start_date}} to {{subs.end_date}} ({{subs.duration}} months)</div>
					</div>
					<div class="card-body">
						<div class="justify-content-between pb-2 align-items-center {{subs.platform_id == 1 ? 'd-none' : 'd-flex'}}">
							<label class="d-flex justify-content-center mb-0 font-weight-bold">
								<span class="text-info">{{subs.platform_name}}</span>
								<span class="text-muted ml-1">Platform</span>
							</label>
							<button class="btn btn-info" ng-click="platformExport(subs.status, $index)">Export</button>
						</div>
						<div class="d-flex justify-content-between pb-2">
							<label class="d-flex flex-column justify-content-center mb-0 font-weight-bold text-uppercase" ng-if="!subs.pay.app_num">{{subs.enr.length==0 ? 'No ' : ''}}Courses</label>
							<div class="d-flex flex-column justify-content-center mb-0" ng-if="!!subs.pay.app_num">
								<label>Application Number</label><label class="font-weight-bold">{{subs.pay.app_num}}</label>
							</div>
							<button class="btn btn-danger" ng-click="subsEdit(subs.status, $index)">Edit</button>
							<!-- <button class="btn btn-danger" ng-click="subsEdit(subs.status, $index)" ng-if="user_can('edit', 'enrollment')">Edit</button> -->
							<!-- <button class="btn btn-danger" ng-click="subsView(subs.status, $index)" ng-if="!user_can('edit', 'enrollment')">View</button> -->
						</div>
						<table class="table">
							<tbody>
								<tr ng-repeat="enr in subs.enr" class="{{enr.complimentary ? 'bg-light' : ''}}">
									<td class="font-weight-bold">{{$index + 1}}</td>
									<td class="text-capitalize w-60 pr-5">
										<div class="d-flex justify-content-between">
											<a class="mb-0" href="/courses/{{enr.course_id}}" target="_blank">{{enr.name.toLowerCase()}}</a>
											<i class="fal fa-tasks-alt text-info" ng-click="showAssignments(enr.course_code, enr.name.toLowerCase())"></i>
										</div>
									</td>
									<td class="w-10 pr-3 {{user.progress[enr.course_code] && user.progress[enr.course_code].p==0 ? 'text-danger' : ''}}">
										<div class="d-flex justify-content-between">
											<label>{{user.progress[enr.course_code] ? user.progress[enr.course_code].p + '%' : 'NA'}}</label>
											<i class="fas fa-file-certificate text-success" ng-show="user.progress[enr.course_code] && user.progress[enr.course_code].c!='0'" title="{{user.progress[enr.course_code].c}}"></i>
										</div>
									</td>
									<td class="pl-5 w-30">
										<div class="d-flex justify-content-between">
											<label class="mb-0">{{enr.section_name}}</label>
											<label class="mb-0 d-flex flex-column justify-content-center" style="font-size:90%">{{enr.section_id}}</label>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="bg-light text-uppercase text-primary text-center py-2">Payments</div>
						<div class="bg-light text-uppercase text-warning text-center py-2" ng-if="!subs.pay.pay_id">No payments data available</div>
						<table class="table" ng-if="!!subs.pay.pay_id">
							<thead>
								<tr>
									<th scope="row" class="w-33 text-center">
										<span ng-if="subs.pay.currency!='fsc'">{{subs.pay.currency=='inr' ? '&#8377;' : '$'}}</span><i class="fas fa-question-circle" ng-if="subs.pay.currency=='fsc'" title="Skillcoin"></i> {{subs.pay.sum_total | number: 0}}
									</th>
									<th scope="row" class="w-33 text-center {{!subs.pay.instl[0].pay_date ? 'text-danger' : ''}}">{{subs.pay.instl[0].pay_date ? subs.pay.instl[0].pay_date : 'Not paid'}}</th>
									<th scope="row" class="w-33 text-center">{{subs.pay.instl[0].agent_name}}</th>
								</tr>
							</thead>
						</table>
						<table class="table" ng-if="!!subs.pay.pay_id">
							<tbody>
								<tr>
									<th scope="row" colspan="4" class="text-center">INSTALLMENTS</th>
								</tr>
								<tr ng-repeat="instl in subs.pay.instl" class="{{!instl.pay_date ? 'text-danger' : ''}}">
									<th class="{{subs.pay.status=='paid' ? 'w-25' : 'w-33'}} text-center">{{$index+1}}</th>
									<td class="{{subs.pay.status=='paid' ? 'w-25' : 'w-33'}} text-center">
										<span ng-if="instl.currency!='fsc'">{{instl.currency=='inr' ? '&#8377;' : '$'}}</span><i class="fas fa-question-circle" ng-if="instl.currency=='fsc'" title="Skillcoin"></i> {{instl.sum | number: 0}}
									</td>
									<td class="{{subs.pay.status=='paid' ? 'w-25' : 'w-33'}} text-center">{{instl.pay_date ? instl.pay_date : instl.due_date}}</td>
									<td class="w-25 text-center" ng-if="subs.pay.status=='paid'">
										<a tabindex="0" class="btn btn-primary font-weight-normal m-0 p-0" role="button" data-toggle="popover" data-trigger="focus" title="{{instl.gateway_name ? instl.gateway_name : instl.pay_mode}}" data-content="{{instl.gateway_reference ?  '<b>Reference</b><br>' + instl.gateway_reference : '' }}{{instl.gateway_reference && instl.pay_comment ? '<br><br>' : ''}}{{instl.pay_comment ? '<b>Comment</b><br>' + instl.pay_comment : ''}}" data-html="true" data-template="<div class='popover' role='tooltip'><div class='arrow'></div><h3 class='popover-header text-capitalize'></h3><div class='popover-body'></div></div>">{{instl.receipt ? instl.receipt : (instl.gateway_name ? instl.gateway_name : instl.pay_mode)}}</a>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div class="card-footer text-muted d-flex justify-content-between" ng-if="subs.status=='active'">
						<span ng-if="subs.support.length>0">
							Welcome email
							<span ng-if="!!subs.support[0].email_sent_at"> sent at {{subs.support[0].email_sent_at}}</span>
							<span ng-if="!subs.support[0].email_sent_at"> not sent yet.</span>
						</span>
						<span ng-if="subs.support.length==0">Welcome email info not available</span>
						<a href="{{sisUrl + subs.sis_file}}" target="_blank" ng-if="subs.sis">SIS import done at {{subs.sis}}</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-2 pt-2 border-left px-2">
		<h5 class="bg-light text-uppercase text-primary text-center py-2">Logs</h5>
		<div class="sidebar px-1">
			<div class="card text-center" ng-if="logs.length==0">
				<div class="card-body">
					<h5>No logs</h5>
				</div>
			</div>
			<div class="card text-center mb-3 {{log.context_type=='subs' ? 'hover-anchor' : ''}}" ng-repeat="log in logs" data-scroll="{{log.context_type=='subs' ? '#subs-' + log.context_id : ''}}" data-highlight="highlight">
				<div class="card-header {{logClasses[log.category_id]}}">{{log.category}}</div>
				<div class="card-body pb-0">
					<p class="card-title" style="white-space: normal;">{{log.description}}</p>
					<p class="card-text text-muted py-2">{{log.name}}</p>
				</div>
				<div class="card-footer text-muted">{{log.created_at}}</div>
			</div>
		</div>
	</div>
</div>
<input type="text" id="hidden-input" class="hidden">
<textarea id="hidden-textarea" class="hidden"></textarea>
<div class="modal fade" id="accessSetup" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{{user.name}}'s Survey Information ({{user.survey_date}})</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="col-6">
						<div class="form-group">
							<label for="ageInput" class="bmd-label-floating">Age</label>
							<input type="text" class="form-control" id="ageInput" ng-model="user.age" disabled>
						</div>
					</div>
					<div class="col-6">
						<div class="form-group">
							<label for="genderInput" class="bmd-label-floating">gender</label>
							<input type="text" class="form-control text-capitalize" id="genderInput" ng-model="user.gender" disabled>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-6">
						<div class="form-group">
							<label for="qualificationInput" class="bmd-label-floating">qualification</label>
							<input type="text" class="form-control" id="qualificationInput" ng-model="user.qualification" disabled>
						</div>
					</div>
					<div class="col-6">
						<div class="form-group">
							<label for="experienceInput" class="bmd-label-floating">Experience</label>
							<input type="text" class="form-control" id="experienceInput" ng-model="user.experience" disabled>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-12">
						<div class="form-group">
							<label for="whyInput" class="bmd-label-floating">Why did you choose a course in Analytics?</label>
							<input type="text" class="form-control" id="whyInput" ng-repeat="whys in user.survey_data.why" value="{{why[whys]}}" disabled ng-if="whys">
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-12">
						<div class="form-group">
							<label for="howInput" class="bmd-label-floating">How did you get to know about Jigsaw Academy?</label>
							<input type="text" class="form-control" id="howInput" ng-repeat="hows in user.leads_media_src" value="{{how[hows]}}" disabled ng-if="hows">
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-12">
						<div class="form-group">
							<label for="knowInput" class="bmd-label-floating">How did you get in touch with us?</label>
							<input type="text" class="form-control" id="knowInput" ng-repeat="knows in user.survey_data.enquiry" value="{{know[knows]}}" disabled ng-if="knows">
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-12">
						<div class="form-group">
							<label for="enrollInput" class="bmd-label-floating">Which of these helped you make up your mind to enroll?</label>
							<input type="text" class="form-control" id="enrollInput" ng-repeat="enrolls in user.survey_data.sales" value="{{enrollWhy[enrolls]}}" disabled ng-if="enrolls">
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="notifications" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{{user.name}}'s Notifications</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<table class="table table-hover">
					<thead>
						<tr>
							<th>#</th>
							<th>Description</th>
							<th>Resolved?</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="notif in notifications">
							<th>{{$index + 1}}</th>
							<td>
								<a class="d-flex flex-column text-decoration-none" href="/notifications/{{notif.id}}">
									<span class="text-dark">{{notif.issue.d}}</span>
									<span class="mt-1 text-muted">{{notif.created_at}}</span>
								</a>
							</td>
							<td>{{notif.resolved_at}}</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="labInformation" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{{user.name}}'s Lab Accounts</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<table class="table table-hover">
					<thead>
						<tr>
							<th>Lab</th>
							<th>Username</th>
							<th>Password</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="lab in user.labs">
							<td>{{lab.lab_ip}}</td>
							<td>{{lab.lab_user}}</td>
							<td>{{lab.lab_pass}}</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="appDebug" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{{user.name}}'s App Debug</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<pre style="max-height: calc(100vh - 15em);" contenteditable="true" id="appDebugPre">{{appDebug}}</pre>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<!-- <button class="btn btn-info" ng-click="textCopyFromElement('#appDebugPre')">copy</button> -->
				<button class="btn btn-info" ng-click="grantAccess()" ng-disabled="!user_can('edit', 'subs') || appAccess=='mobile_friendly'">Grant Access</button>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="freezeInformation" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{{user.name}}'s Freeze Information</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<table class="table">
					<thead>
						<tr>
							<th>#</th>
							<th>From</th>
							<th>To</th>
							<th>Free?</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="f in user.freeze">
							<th>{{$index + 1}}</th>
							<td><input type="date" class="form-control" ng-model="f.start_date" format-date></td>
							<td><input type="date" class="form-control" ng-model="f.end_date" format-date></td>
							<td>
								<div class="checkbox">
									<label>
										<input type="checkbox" ng-model="f.is_free">
									</label>
								</div>
							</td>
						</tr>
						<tr>
							<td colspan="4" class="text-center">
								<button class="btn btn-info btn-raised" ng-click="user.freeze.push({start_date: null, end_date: null, is_free: true})"><i class="material-icons">add</i></button>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="editSubs" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{{editableSubs.editable ? 'Edit' : 'View'}} subscription</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form name="subscription">
					<div class="form-group">
						<select class="form-control" ng-model="editableSubs.bundle_id" ng-change="bundleChange()" ng-attr-disabled="{{!editableSubs.editable ? 'true' : 'false'}}">
							<option value="0">None</option>
							<optgroup label="Specializations"></optgroup>
							<option ng-repeat="(id, bundle) in bundles.specializations" value="{{id}}">{{bundle.name}}</option>
							<optgroup label="Bootcamps"></optgroup>
							<option ng-repeat="(id, bundle) in bundles.bootcamps" value="{{id}}">{{bundle.name}}</option>
							<optgroup label="Programs"></optgroup>
							<option ng-repeat="(id, bundle) in bundles.programs" value="{{id}}">{{bundle.name}}</option>
						</select>
					</div>
					<div class="form-group" ng-if="batches.type!='none'">
						<label for="specializationBatch">Batch</label>
						<select class="form-control" id="specializationBatch" ng-model="editableSubs.batch" ng-change="batchChange()" ng-attr-disabled="{{!editableSubs.editable ? 'true' : 'false'}}">
							<option ng-repeat="(i, b) in batches.l" value="{{i}}" ng-disabled="{{i==0}}">{{b}}</option>
						</select>
					</div>
					<ul class="nav nav-tabs bg-primary nav-fill">
						<li class="nav-item">
							<a class="nav-link active" data-toggle="tab" data-target="#coursesTab" href="">Courses</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" data-toggle="tab" data-target="#accessTab" href="">Access</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" data-toggle="tab" data-target="#paymentsTab" href="">Payments</a>
						</li>
						<li class="nav-item bg-warning">
							<a class="nav-link" data-toggle="tab" data-target="#operationsTab" href="">Operations</a>
						</li>
					</ul>
					<div class="tab-content px-1 py-2">
						<div class="tab-pane fade active show" id="coursesTab" role="tabpanel" aria-labelledby="courses-tab">
							<div>
								<table class="table table-sm">
									<tbody>
										<tr ng-repeat="enr in editableSubs.enr" class="{{enr.complimentary ? 'bg-light' : ''}} {{enr.status=='deleted' ? 'bg-secondary text-white' : ''}} bg-transition">
											<th class="align-middle">{{$index + 1}}</th>
											<td class="text-capitalize align-middle">
												<select class="form-control text-capitalize d-flex justify-content-between" ng-model="enr.course_id" ng-change="enrChange(enr)">
													<option value="0">Please select one</option>
													<option ng-repeat="c in courses" value="{{c.course_id}}">{{c.name.toLowerCase()}} ({{c.sis_id}})</option>
												</select>
											</td>
											<td>
												<select class="form-control" ng-model="enr.section_num" ng-disabled="{{enr.status=='deleted' ? 'true' : 'false'}}">
													<option ng-repeat="(i, b) in courseBatches" value="{{i}}" ng-disabled="{{i==0}}">{{b}}</option>
												</select>
											</td>
											<td>
												<div class="checkbox">
													<label>
														<input type="checkbox" ng-model="enr.complimentary">
													</label>
												</div>
											</td>
											<td>
												<button type="button" class="btn {{enr.status=='deleted' ? 'btn-info' : 'btn-danger'}} bmd-btn-fab bmd-btn-fab-sm" ng-click="enrToggle(enr)">
													<i class="material-icons">{{enr.status=='deleted' ? 'add' : 'remove'}}</i>
												</button>
											</td>
										</tr>
										<tr ng-repeat="enr in editableSubs.newEnrs">
											<th class="align-middle">{{editableSubs.enr.length + $index + 1}}</th>
											<td class="text-capitalize align-middle">
												<select class="form-control text-capitalize d-flex justify-content-between" ng-model="enr.course_id" ng-change="newCourseAdd(enr)">
													<option value="0">Please select one</option>
													<option ng-repeat="c in courses" value="{{c.course_id}}">{{c.name.toLowerCase()}} ({{c.sis_id}})</option>
												</select>
											</td>
											<td>
												<select class="form-control" ng-model="enr.section_num">
													<option ng-repeat="(i, b) in courseBatches" value="{{i}}">{{b}}</option>
												</select>
											</td>
											<td>
												<button type="button" class="btn btn-danger bmd-btn-fab bmd-btn-fab-sm" ng-click="enrToggle(enr)">
													<i class="material-icons">remove</i>
												</button>
											</td>
										</tr>
										<tr ng-if="editableSubs.editable">
											<td colspan="4">
												<button class="btn btn-info btn-raised w-100" title="Add a new course" ng-click="editableSubs.enr.push({complimentary: false, section_num: editableSubs.batch, new: true, course_id: '0', status: 'active'})">
													<i class="material-icons">add</i>
												</button>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<div class="tab-pane fade" id="accessTab" role="tabpanel" aria-labelledby="access-tab">
							<div>
								<table class="table table-hover">
									<thead>
										<tr>
											<th>#</th>
											<th>From</th>
											<th>To</th>
											<th>Free?</th>
										</tr>
									</thead>
									<tbody>
										<tr ng-repeat="ad in editableSubs.dates">
											<th>{{$index + 1}}</th>
											<td><input id="ad-{{$id}}" type="date" class="form-control" ng-model="ad.start_date" format-date ng-change="accessDateChange(this, 0)" data-orig="{{ad.start_date}}"></td>
											<td><input id="ad-{{$id}}" type="date" class="form-control" ng-model="ad.end_date" format-date ng-change="accessDateChange(this, 1)" data-orig="{{ad.end_date}}"></td>
											<td>
												<div class="checkbox {{$index==0 ? 'disabled' : ''}}">
													<label>
														<input type="checkbox" ng-model="ad.is_free" ng-disabled="$index==0">
													</label>
												</div>
											</td>
										</tr>
										<tr ng-repeat="ad in editableSubs.newDurations">
											<th class="align-middle">{{editableSubs.durations.length + $index + 1}}</th>
											<td><input type="date" class="form-control" ng-model="ad.start_date" format-date ng-change="newAccessDateChange($index)"></td>
											<td><input type="date" class="form-control" ng-model="ad.end_date" format-date ng-change="newAccessDateChange($index)"></td>
											<td>
												<div class="checkbox">
													<label>
														<input type="checkbox" ng-model="ad.is_free">
													</label>
												</div>
											</td>
										</tr>
										<tr ng-if="editableSubs.editable">
											<td colspan="4">
												<button class="btn btn-info btn-raised w-100" title="Add new access extension" ng-click="editableSubs.dates.push({start_date: '', end_date: '', is_free: true})">
													<i class="material-icons">add</i>
												</button>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<div class="tab-pane fade" id="paymentsTab" role="tabpanel" aria-labelledby="payments-tab">
							<div class="bg-light text-uppercase text-primary text-center py-2 mb-1">Master</div>
							<div class="row mx-0">
								<div class="form-group bmd-form-group col-10 px-0">
									<label for="totalAmount" class="bmd-label-floating">Total</label>
									<input type="number" class="form-control" id="totalAmount" ng-model="editableSubs.pay.sum_total" format-number>
								</div>
								<div class="form-group bmd-form-group col-2">
									<label for="currency" class="bmd-label-floating">Currency</label>
									<select id="currency" ng-model="editableSubs.pay.currency" class="form-control">
										<option value="inr">₹</option>
										<option value="usd">$</option>
										<option value="fsc" disabled>?</option>
									</select>
								</div>
							</div>
							<div class="bg-light text-uppercase text-primary text-center py-2 mb-1">installments</div>
							<div class="d-flex flex-column border-bottom mx-3" ng-repeat="instl in editableSubs.pay.instl">
								<div class="d-flex">
									<div class="d-flex flex-column justify-content-center font-weight-bold">{{$index + 1}}</div>
									<div class="w-25 ml-3">
										<div class="form-group">
											<label for="instlAmount" class="bmd-label-floating">Total</label>
											<input type="number" class="form-control" id="instlAmount" ng-model="instl.sum" format-number>
										</div>
									</div>
									<div class="w-25 ml-3">
										<div class="form-group">
											<label for="currency" class="bmd-label-floating">Currency</label>
											<select id="currency" ng-model="editableSubs.pay.currency" class="form-control">
												<option value="inr">₹</option>
												<option value="usd">$</option>
												<option value="fsc" disabled>?</option>
											</select>
										</div>
									</div>
									<div class="w-25 ml-3">
										<div class="form-group">
											<label for="paidOn" class="bmd-label-floating">Paid on</label>
											<input type="date" format-date ng-model="instl.pay_date_plain" class="form-control" id="paidOn">
										</div>
									</div>
									<div class="w-25 ml-3">
										<div class="form-group">
											<label for="dueOn" class="bmd-label-floating">Due on</label>
											<input type="date" format-date ng-model="instl.due_date_plain" class="form-control" id="dueOn">
										</div>
									</div>
								</div>
								<div class="d-flex">
									<div class="form-group bmd-form-group w-100">
										<label for="payComment" class="bmd-label-floating">Comment</label>
										<textarea ng-model="instl.pay_comment" class="form-control" id="payComment"></textarea>
									</div>
								</div>
							</div>
							<div class="d-flex mt-3">
								<div class="w-100 d-flex justify-content-center">
									<button class="btn btn-info btn-raised" title="Add a new course" ng-click="editableSubs.pay.instl.push({sum: null, currency: null, pay_date: null, due_date: null})"><i class="material-icons">add</i></button>
								</div>
							</div>
						</div>
						<div class="tab-pane fade" id="operationsTab" role="tabpanel" aria-labelledby="operations-tab">
							<div class="bg-light text-uppercase text-primary text-center py-2 mb-1"><b>NOTE:</b> Options here could potentially mess the subscription up. Please use wisely.</div>
							<div ng-if="editableSubs.status=='inactive'" class="d-flex flex-column">
								<div class="d-flex justify-content-center">
									<p>This subscription is inactive. To enable it, please click below.</p>
								</div>
								<div class="d-flex justify-content-center">
									<button class="btn btn-danger btn-raised" ng-click="editableSubs.statusNew='reinstate'" ng-disabled="editableSubs.statusNew=='reinstate'">Enable</button>
								</div>
							</div>
							<div ng-if="editableSubs.status=='active' || editableSubs.status=='pending'" class="d-flex flex-column">
								<div class="d-flex justify-content-center">
									<p>This subscription is {{editableSubs.status}}.</p>
								</div>
								<div class="d-flex justify-content-center">
									<button class="btn btn-danger btn-raised mr-2" ng-click="editableSubs.statusNew='refunded'" ng-disabled="editableSubs.statusNew=='refunded'">refund</button>
									<button class="btn btn-danger btn-raised mr-2" ng-click="editableSubs.statusNew='blocked'" ng-disabled="editableSubs.statusNew=='disabled'">disable</button>
									<button class="btn btn-danger btn-raised" ng-click="editableSubs.statusNew='alumni'" ng-disabled="editableSubs.statusNew=='alumni'">alumni</button>
								</div>
							</div>
							<div ng-if="editableSubs.status=='blocked' || editableSubs.status=='refunded' || editableSubs.status=='expired' || editableSubs.status=='disabled'" class="d-flex flex-column">
								<div class="d-flex justify-content-center">
									<p>This subscription is {{editableSubs.status}}.</p>
								</div>
								<div class="d-flex justify-content-center">
									<button class="btn btn-danger btn-raised" ng-click="editableSubs.statusNew='reinstate'" ng-disabled="editableSubs.statusNew=='reinstate'">reinstate</button>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" ng-disabled="!subscription.$dirty && !editableSubs.statusNew" ng-click="saveSubs()" ng-if="editableSubs.editable">Save changes</button>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="profile" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{{tempUser.name}}'s Profile</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form name="profile">
					<ul class="nav nav-tabs nav-fill bg-secondary" id="profileTabs" role="tablist">
						<li class="nav-item">
							<a class="nav-link text-white active" id="contact-tab" data-toggle="tab" data-target="#contactTab" href="" role="tab" aria-controls="contact" aria-selected="true">Contact</a>
						</li>
						<li class="nav-item">
							<a class="nav-link text-white" id="freeze-tab" data-toggle="tab" data-target="#freezeTab" href="" role="tab" aria-controls="freeze" aria-selected="false">Freeze</a>
						</li>
						<li class="nav-item">
							<a class="nav-link text-white" id="advanced-tab" data-toggle="tab" data-target="#advancedTab" href="" role="tab" aria-controls="advanced" aria-selected="false">Advanced</a>
						</li>
					</ul>
					<div class="tab-content mt-3">
						<div class="tab-pane fade show active" id="contactTab" role="tabpanel" aria-labelledby="contact-tab">
							<div class="bg-light text-uppercase text-primary text-center py-2">primary</div>
							<div class="form-inline">
								<div class="form-group bmd-form-group w-45">
									<label for="userName" class="bmd-label-floating">Name</label>
									<input type="text" id="userName" class="form-control w-100" ng-model="tempUser.name">
								</div>
								<div class="form-group bmd-form-group w-45 ml-auto">
									<label for="userPhone" class="bmd-label-floating">Phone</label>
									<input type="text" id="userPhone" class="form-control w-100" ng-model="tempUser.phone">
								</div>
							</div>
							<div class="form-inline">
								<div class="form-group bmd-form-group w-45">
									<label for="userEmail1" class="bmd-label-floating">Email</label>
									<input type="email" id="userEmail1" class="form-control w-100" ng-model="tempUser.email">
								</div>
								<div class="form-group bmd-form-group w-45 ml-auto">
									<label for="userEmail2" class="bmd-label-floating">Email 2</label>
									<input type="email" id="userEmail2" class="form-control w-100" ng-model="tempUser.email_2">
								</div>
							</div>
							<div class="bg-light text-uppercase text-primary text-center py-2 mt-3">social</div>
							<table class="table">
								<tbody>
									<tr class="{{tempUser.lms_soc=='fb' ? 'bg-light' : ''}}">
										<td class="w-90 p-0">
											<div class="form-group bmd-form-group m-0">
												<label for="userSocFb" class="bmd-label-floating">Facebook {{tempUser.lms_soc=='fb' ? '(JLC Login)' : ''}}</label>
												<input type="email" id="userSocFb" class="form-control w-100" ng-model="tempUser.soc_fb">
											</div>
										</td>
										<td class="hover-btn align-middle p-0">
											<div class="d-flex justify-content-center align-items-end">
												<button class="d-none btn btn-primary bmd-btn-fab bmd-btn-fab-sm m-0 {{tempUser.soc_fb && tempUser.lms_soc!='fb' ? '' : 'no-soc'}}" ng-click="tempUser.lms_soc='fb'"></button>
											</div>
										</td>
									</tr>
									<tr class="{{tempUser.lms_soc=='gp' ? 'bg-light' : ''}}">
										<td class="w-90 p-0">
											<div class="form-group bmd-form-group m-0">
												<label for="userSocGp" class="bmd-label-floating">Google+ {{tempUser.lms_soc=='gp' ? '(JLC Login)' : ''}}</label>
												<input type="email" id="userSocGp" class="form-control w-100" ng-model="tempUser.soc_gp">
											</div>
										</td>
										<td class="hover-btn align-middle p-0">
											<div class="d-flex justify-content-center align-items-end">
												<button class="d-none btn btn-primary bmd-btn-fab bmd-btn-fab-sm m-0 {{tempUser.soc_gp && tempUser.lms_soc!='gp' ? '' : 'no-soc'}}" ng-click="tempUser.lms_soc='gp'"></button>
											</div>
										</td>
									</tr>
									<tr class="{{tempUser.lms_soc=='li' ? 'bg-light' : ''}}">
										<td class="w-90 p-0">
											<div class="form-group bmd-form-group m-0">
												<label for="userSocLi" class="bmd-label-floating">LinkedIn {{tempUser.lms_soc=='li' ? '(JLC Login)' : ''}}</label>
												<input type="email" id="userSocLi" class="form-control w-100" ng-model="tempUser.soc_li">
											</div>
										</td>
										<td class="hover-btn align-middle p-0">
											<div class="d-flex justify-content-center align-items-end">
												<button class="d-none btn btn-primary bmd-btn-fab bmd-btn-fab-sm m-0 {{tempUser.soc_li && tempUser.lms_soc!='li' ? '' : 'no-soc'}}" ng-click="tempUser.lms_soc='li'"></button>
											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
						<div class="tab-pane fade" id="freezeTab" role="tabpanel" aria-labelledby="freeze-tab">
							<table class="table">
								<thead>
									<tr>
										<th>#</th>
										<th>From</th>
										<th>To</th>
										<th>Free?</th>
									</tr>
								</thead>
								<tbody>
									<tr ng-repeat="f in tempUser.freeze">
										<th>{{$index + 1}}</th>
										<td><input type="date" class="form-control" ng-model="f.start_date" format-date></td>
										<td><input type="date" class="form-control" ng-model="f.end_date" format-date></td>
										<td>
											<div class="checkbox">
												<label>
													<input type="checkbox" ng-model="f.is_free">
												</label>
											</div>
										</td>
									</tr>
									<tr>
										<td colspan="4" class="text-center">
											<button class="btn btn-info btn-raised" ng-click="tempUser.freeze.push({start_date: null, end_date: null, is_free: true})"><i class="material-icons">add</i></button>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
						<div class="tab-pane fade" id="advancedTab" role="tabpanel" aria-labelledby="advanced-tab">
							<div class="bg-light text-uppercase text-primary text-center py-2 mt-3">account</div>
							<div class="d-flex justify-content-center mt-3">
								<!-- <button class="btn btn-danger btn-raised mr-3">block</button> -->
								<button class="btn btn-danger btn-raised" ng-show="tempUser.jlc.canRevoke() == 1" ng-click="tempUser.jlc.revoke()">revoke access</button>
								<button class="btn btn-danger btn-raised" ng-show="tempUser.jlc.canRevoke() == 0" ng-click="tempUser.jlc.grant()">grant access</button>
							</div>
							<div class="bg-light text-uppercase text-primary text-center py-2 mt-3">subscription</div>
							<div class="d-flex justify-content-center mt-3">
								<button class="btn btn-danger btn-raised">Add</button>
							</div>
							<div class="d-flex justify-content-center">
								<label class="text-danger text-center">NOTE: This is backdoor entrance to adding subscriptions to a user. It bypasses any payment requirement. Please use to responsibly.</label>
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" ng-disabled="!profile.$dirty && tempUser.lms_soc==user.lms_soc">Save</button>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="assignments" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{{user.name}}'s App Debug</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<table class="table table-striped">
					<thead>
						<tr>
							<th>#</th>
							<th>Title</th>
							<th>Score</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="a in assignments">
							<th>{{$index + 1}}</th>
							<td>
								<a target="_blank" href="https://jigsawacademy.net/courses/{{a.context_id}}/assignments/{{a.id}}/{{a.submitted_at ? 'submissions/' + a.user_id : ''}}">{{a.title}}</a>
							</td>
							<td class="text-capitalize">{{a.grade ? a.grade + "/" + a.points_possible : a.submitted ? a.submitted : 'Unattempted'}}</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="platforms" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{{user.name}}'s Platforms</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<table class="table table-striped">
					<thead>
						<tr>
							<th>#</th>
							<th>Platform</th>
							<th>Password</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="p in user.platforms">
							<th>{{$index + 1}}</th>
							<td>{{p.name}}</td>
							<td>{{p.password}}</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="exportInfo" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Platform Export</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<ul class="nav nav-tabs bg-secondary nav-fill">
					<li class="nav-item">
						<a class="nav-link py-2 text-white active" data-toggle="tab" data-target="#exportRequest" href="">Request</a>
					</li>
					<li class="nav-item">
						<a class="nav-link py-2 text-white" data-toggle="tab" data-target="#exportResponse" href="">Response</a>
					</li>
				</ul>
				<div class="tab-content px-1 py-2">
					<div class="tab-pane fade active show" id="exportRequest" role="tabpanel">
						<pre class="pre-tag">{{exportRequest}}</pre>
					</div>
					<div class="tab-pane fade" id="exportResponse" role="tabpanel">
						<pre class="pre-tag">{{exportResponse}}</pre>
					</div>
				</div>
				<label class="text-muted">Exported At: <span class="text-info">{{exportedAt}}</span></label>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>